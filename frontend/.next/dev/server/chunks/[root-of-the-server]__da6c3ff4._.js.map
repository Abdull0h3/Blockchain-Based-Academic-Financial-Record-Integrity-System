{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Desktop/Fifth semester/blockchain/project/frontend/app/abi.json"],"sourcesContent":["[{\"inputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"string\",\"name\":\"studentId\",\"type\":\"string\"},{\"indexed\":false,\"internalType\":\"string\",\"name\":\"documentHash\",\"type\":\"string\"}],\"name\":\"RecordIssued\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"string\",\"name\":\"studentId\",\"type\":\"string\"}],\"name\":\"RecordRevoked\",\"type\":\"event\"},{\"inputs\":[],\"name\":\"admin\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"_studentId\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"_documentHash\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"_issuer\",\"type\":\"string\"}],\"name\":\"issueRecord\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"_studentId\",\"type\":\"string\"}],\"name\":\"revokeRecord\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"_studentId\",\"type\":\"string\"}],\"name\":\"verifyRecord\",\"outputs\":[{\"components\":[{\"internalType\":\"string\",\"name\":\"studentId\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"documentHash\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"issuer\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"timestamp\",\"type\":\"uint256\"},{\"internalType\":\"bool\",\"name\":\"isValid\",\"type\":\"bool\"}],\"internalType\":\"struct AcademicRecords.Record\",\"name\":\"\",\"type\":\"tuple\"}],\"stateMutability\":\"view\",\"type\":\"function\"}]"],"names":[],"mappings":"AAAA"}},
    {"offset": {"line": 111, "column": 1585}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmed/Desktop/Fifth%20semester/blockchain/project/frontend/app/lib/blockchain.js"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport ABI from \"../abi.json\";\r\n\r\nfunction validateEnv() {\r\n  const required = [\"PRIVATE_KEY\", \"CONTRACT_ADDRESS\"];\r\n  const missing = required.filter((key) => !process.env[key]);\r\n\r\n  if (missing.length > 0) {\r\n    throw new Error(`Missing required environment variables: ${missing.join(\", \")}`);\r\n  }\r\n}\r\n\r\nvalidateEnv();\r\n\r\n// Provider = read/write connection to the Ethereum JSON-RPC node.\r\n// It talks to Hardhat local chain at http://127.0.0.1:8545.\r\nconst provider = new ethers.JsonRpcProvider(process.env.RPC_URL || \"http://127.0.0.1:8545\");\r\n\r\n// Wallet = backend signing identity. Every state-changing tx is signed with\r\n// this private key before being broadcast. The key must stay server-side only.\r\nconst wallet = new ethers.Wallet(process.env.PRIVATE_KEY, provider);\r\n\r\n// Contract instance bound to the signing wallet.\r\n// Digital signature flow:\r\n// 1) API route calls a write method (e.g., issueRecord).\r\n// 2) ethers prepares transaction data.\r\n// 3) wallet signs tx with PRIVATE_KEY.\r\n// 4) signed tx is sent to chain and validated by nodes.\r\nconst contract = new ethers.Contract(process.env.CONTRACT_ADDRESS, ABI, wallet);\r\n\r\nlet contractCodeValidated = false;\r\n\r\nexport async function ensureContractIsDeployed() {\r\n  if (contractCodeValidated) {\r\n    return;\r\n  }\r\n\r\n  const code = await provider.getCode(process.env.CONTRACT_ADDRESS);\r\n  if (!code || code === \"0x\") {\r\n    throw new Error(\r\n      \"Invalid CONTRACT_ADDRESS: no contract bytecode found. Set CONTRACT_ADDRESS to the deployed AcademicRecords contract address.\"\r\n    );\r\n  }\r\n\r\n  contractCodeValidated = true;\r\n}\r\n\r\nexport { provider, wallet, contract };\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,SAAS;IACP,MAAM,WAAW;QAAC;QAAe;KAAmB;IACpD,MAAM,UAAU,SAAS,MAAM,CAAC,CAAC,MAAQ,CAAC,QAAQ,GAAG,CAAC,IAAI;IAE1D,IAAI,QAAQ,MAAM,GAAG,GAAG;QACtB,MAAM,IAAI,MAAM,CAAC,wCAAwC,EAAE,QAAQ,IAAI,CAAC,OAAO;IACjF;AACF;AAEA;AAEA,kEAAkE;AAClE,4DAA4D;AAC5D,MAAM,WAAW,IAAI,+PAAM,CAAC,eAAe,CAAC,QAAQ,GAAG,CAAC,OAAO,IAAI;AAEnE,4EAA4E;AAC5E,+EAA+E;AAC/E,MAAM,SAAS,IAAI,+PAAM,CAAC,MAAM,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;AAE1D,iDAAiD;AACjD,0BAA0B;AAC1B,yDAAyD;AACzD,uCAAuC;AACvC,uCAAuC;AACvC,wDAAwD;AACxD,MAAM,WAAW,IAAI,+PAAM,CAAC,QAAQ,CAAC,QAAQ,GAAG,CAAC,gBAAgB,EAAE,gKAAG,EAAE;AAExE,IAAI,wBAAwB;AAErB,eAAe;IACpB,IAAI,uBAAuB;QACzB;IACF;IAEA,MAAM,OAAO,MAAM,SAAS,OAAO,CAAC,QAAQ,GAAG,CAAC,gBAAgB;IAChE,IAAI,CAAC,QAAQ,SAAS,MAAM;QAC1B,MAAM,IAAI,MACR;IAEJ;IAEA,wBAAwB;AAC1B"}},
    {"offset": {"line": 199, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmed/Desktop/Fifth%20semester/blockchain/project/frontend/app/lib/db.js"],"sourcesContent":["import mysql from \"mysql2/promise\";\r\n\r\nlet pool;\r\n\r\nfunction createPool() {\r\n  const parsedPort = process.env.DB_PORT ? Number(process.env.DB_PORT) : 3306;\r\n\r\n  return mysql.createPool({\r\n    host: process.env.DB_HOST,\r\n    user: process.env.DB_USER,\r\n    password: process.env.DB_PASSWORD,\r\n    database: process.env.DB_NAME || \"academic_system\",\r\n    waitForConnections: true,\r\n    port: Number.isNaN(parsedPort) ? 3306 : parsedPort,\r\n    connectionLimit: 10,\r\n    queueLimit: 0,\r\n  });\r\n}\r\n\r\nexport async function getPool() {\r\n  try {\r\n    if (!pool) {\r\n      pool = createPool();\r\n    }\r\n\r\n    // Lightweight health-check to fail fast if DB credentials are invalid.\r\n    await pool.query(\"SELECT 1\");\r\n    return pool;\r\n  } catch (error) {\r\n    console.error(\"Database connection error:\", error);\r\n    throw new Error(\"Failed to connect to MySQL\");\r\n  }\r\n}\r\n\r\nexport async function executeQuery(sql, params = []) {\r\n  try {\r\n    const db = await getPool();\r\n    const [result] = await db.execute(sql, params);\r\n    return result;\r\n  } catch (error) {\r\n    console.error(\"Database query error:\", error);\r\n    throw new Error(\"Database query failed\");\r\n  }\r\n}\r\n\r\nexport { pool };\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,IAAI;AAEJ,SAAS;IACP,MAAM,aAAa,QAAQ,GAAG,CAAC,OAAO,GAAG,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IAEvE,OAAO,iNAAK,CAAC,UAAU,CAAC;QACtB,MAAM,QAAQ,GAAG,CAAC,OAAO;QACzB,MAAM,QAAQ,GAAG,CAAC,OAAO;QACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;QACjC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;QACjC,oBAAoB;QACpB,MAAM,OAAO,KAAK,CAAC,cAAc,OAAO;QACxC,iBAAiB;QACjB,YAAY;IACd;AACF;AAEO,eAAe;IACpB,IAAI;QACF,IAAI,CAAC,MAAM;YACT,OAAO;QACT;QAEA,uEAAuE;QACvE,MAAM,KAAK,KAAK,CAAC;QACjB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,eAAe,aAAa,GAAG,EAAE,SAAS,EAAE;IACjD,IAAI;QACF,MAAM,KAAK,MAAM;QACjB,MAAM,CAAC,OAAO,GAAG,MAAM,GAAG,OAAO,CAAC,KAAK;QACvC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM,IAAI,MAAM;IAClB;AACF"}},
    {"offset": {"line": 251, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmed/Desktop/Fifth%20semester/blockchain/project/frontend/app/api/verify/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { createHash } from \"crypto\";\r\nimport { contract, ensureContractIsDeployed } from \"../../lib/blockchain\";\r\nimport { executeQuery } from \"../../lib/db\";\r\n\r\nexport const runtime = \"nodejs\";\r\n\r\nfunction toDateOnlyString(value) {\r\n  if (!value) {\r\n    return null;\r\n  }\r\n  const date = value instanceof Date ? value : new Date(value);\r\n  if (Number.isNaN(date.getTime())) {\r\n    return null;\r\n  }\r\n  return date.toISOString().slice(0, 10);\r\n}\r\n\r\nfunction toGraduationYear(value) {\r\n  if (!value) {\r\n    return null;\r\n  }\r\n  const date = value instanceof Date ? value : new Date(value);\r\n  if (Number.isNaN(date.getTime())) {\r\n    return null;\r\n  }\r\n  return String(date.getUTCFullYear());\r\n}\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    await ensureContractIsDeployed();\r\n\r\n    const body = await request.json();\r\n    const { studentId } = body;\r\n\r\n    if (!studentId) {\r\n      return NextResponse.json(\r\n        { success: false, error: \"studentId is required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const normalizedStudentId = String(studentId).trim();\r\n    const certificateRows = await executeQuery(\r\n      `\r\n        SELECT\r\n          student_id,\r\n          full_name,\r\n          program,\r\n          cgpa,\r\n          graduation_date,\r\n          document_hash,\r\n          blockchain_tx_hash,\r\n          is_revoked,\r\n          issued_at\r\n        FROM certificates\r\n        WHERE student_id = ?\r\n        ORDER BY id DESC\r\n        LIMIT 1\r\n      `,\r\n      [normalizedStudentId]\r\n    );\r\n\r\n    if (certificateRows.length === 0) {\r\n      return NextResponse.json(\r\n        { success: false, error: \"Certificate not found in database\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const certificate = certificateRows[0];\r\n    if (!(\"full_name\" in certificate) || !(\"program\" in certificate)) {\r\n      return NextResponse.json(\r\n        {\r\n          success: false,\r\n          error:\r\n            \"Certificates schema must include full_name and program columns for immutable verification\",\r\n        },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    let blockchainRecord;\r\n    try {\r\n      blockchainRecord = await contract.verifyRecord(normalizedStudentId);\r\n    } catch (error) {\r\n      const message = error.shortMessage || error.message || \"Blockchain lookup failed\";\r\n      const isNotFound = message.includes(\"Record not found\") || message.includes(\"BAD_DATA\");\r\n      if (isNotFound) {\r\n        return NextResponse.json(\r\n          { success: false, error: \"Record not found on blockchain\" },\r\n          { status: 404 }\r\n        );\r\n      }\r\n      throw error;\r\n    }\r\n\r\n    const graduationDate = toDateOnlyString(certificate.graduation_date);\r\n    const graduationYear = toGraduationYear(certificate.graduation_date);\r\n    const cgpaFormatted = Number(certificate.cgpa).toFixed(2);\r\n\r\n    // Primary canonical format (must match issuance logic exactly):\r\n    // `${studentId}|${fullName}|${program}|${cgpa.toFixed(2)}|${graduationYear}`\r\n    const canonical = `${certificate.student_id}|${certificate.full_name}|${certificate.program}|${cgpaFormatted}|${graduationYear}`;\r\n    const recalculatedHash = createHash(\"sha256\").update(canonical).digest(\"hex\");\r\n\r\n    // Backward-compatible fallback if any old issuance used graduation_date directly.\r\n    const legacyCanonical = `${certificate.student_id}|${certificate.full_name}|${certificate.program}|${cgpaFormatted}|${graduationDate}`;\r\n    const legacyRecalculatedHash = createHash(\"sha256\").update(legacyCanonical).digest(\"hex\");\r\n\r\n    const integrityValid =\r\n      recalculatedHash === blockchainRecord.documentHash ||\r\n      legacyRecalculatedHash === blockchainRecord.documentHash;\r\n    const issueTimestamp = blockchainRecord.timestamp.toString();\r\n    const isRevoked = Boolean(certificate.is_revoked) || !blockchainRecord.isValid;\r\n\r\n    return NextResponse.json({\r\n      studentId: certificate.student_id,\r\n      fullName: certificate.full_name,\r\n      program: certificate.program,\r\n      cgpa: certificate.cgpa,\r\n      graduationDate,\r\n      issuer: blockchainRecord.issuer,\r\n      issueTimestamp,\r\n      isRevoked,\r\n      blockchainHash: blockchainRecord.documentHash,\r\n      recalculatedHash,\r\n      integrityValid,\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Verify API error:\", error);\r\n\r\n    return NextResponse.json(\r\n      { success: false, error: error.shortMessage || error.message || \"Internal server error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}