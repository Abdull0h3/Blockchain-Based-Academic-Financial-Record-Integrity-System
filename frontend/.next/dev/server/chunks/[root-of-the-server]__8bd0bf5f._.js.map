{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmed/Desktop/Fifth%20semester/blockchain/project/frontend/app/lib/db.js"],"sourcesContent":["import mysql from \"mysql2/promise\";\r\n\r\nlet pool;\r\n\r\nfunction createPool() {\r\n  const parsedPort = process.env.DB_PORT ? Number(process.env.DB_PORT) : 3306;\r\n\r\n  return mysql.createPool({\r\n    host: process.env.DB_HOST,\r\n    user: process.env.DB_USER,\r\n    password: process.env.DB_PASSWORD,\r\n    database: process.env.DB_NAME || \"academic_system\",\r\n    waitForConnections: true,\r\n    port: Number.isNaN(parsedPort) ? 3306 : parsedPort,\r\n    connectionLimit: 10,\r\n    queueLimit: 0,\r\n  });\r\n}\r\n\r\nexport async function getPool() {\r\n  try {\r\n    if (!pool) {\r\n      pool = createPool();\r\n    }\r\n\r\n    // Lightweight health-check to fail fast if DB credentials are invalid.\r\n    await pool.query(\"SELECT 1\");\r\n    return pool;\r\n  } catch (error) {\r\n    console.error(\"Database connection error:\", error);\r\n    throw new Error(\"Failed to connect to MySQL\");\r\n  }\r\n}\r\n\r\nexport async function executeQuery(sql, params = []) {\r\n  try {\r\n    const db = await getPool();\r\n    const [result] = await db.execute(sql, params);\r\n    return result;\r\n  } catch (error) {\r\n    console.error(\"Database query error:\", error);\r\n    throw new Error(\"Database query failed\");\r\n  }\r\n}\r\n\r\nexport { pool };\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,IAAI;AAEJ,SAAS;IACP,MAAM,aAAa,QAAQ,GAAG,CAAC,OAAO,GAAG,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IAEvE,OAAO,iNAAK,CAAC,UAAU,CAAC;QACtB,MAAM,QAAQ,GAAG,CAAC,OAAO;QACzB,MAAM,QAAQ,GAAG,CAAC,OAAO;QACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;QACjC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;QACjC,oBAAoB;QACpB,MAAM,OAAO,KAAK,CAAC,cAAc,OAAO;QACxC,iBAAiB;QACjB,YAAY;IACd;AACF;AAEO,eAAe;IACpB,IAAI;QACF,IAAI,CAAC,MAAM;YACT,OAAO;QACT;QAEA,uEAAuE;QACvE,MAAM,KAAK,KAAK,CAAC;QACjB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,eAAe,aAAa,GAAG,EAAE,SAAS,EAAE;IACjD,IAAI;QACF,MAAM,KAAK,MAAM;QACjB,MAAM,CAAC,OAAO,GAAG,MAAM,GAAG,OAAO,CAAC,KAAK;QACvC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM,IAAI,MAAM;IAClB;AACF"}},
    {"offset": {"line": 193, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Desktop/Fifth semester/blockchain/project/frontend/app/abi.json"],"sourcesContent":["[{\"inputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"string\",\"name\":\"studentId\",\"type\":\"string\"},{\"indexed\":false,\"internalType\":\"string\",\"name\":\"documentHash\",\"type\":\"string\"}],\"name\":\"RecordIssued\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"string\",\"name\":\"studentId\",\"type\":\"string\"}],\"name\":\"RecordRevoked\",\"type\":\"event\"},{\"inputs\":[],\"name\":\"admin\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"_studentId\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"_documentHash\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"_issuer\",\"type\":\"string\"}],\"name\":\"issueRecord\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"_studentId\",\"type\":\"string\"}],\"name\":\"revokeRecord\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"_studentId\",\"type\":\"string\"}],\"name\":\"verifyRecord\",\"outputs\":[{\"components\":[{\"internalType\":\"string\",\"name\":\"studentId\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"documentHash\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"issuer\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"timestamp\",\"type\":\"uint256\"},{\"internalType\":\"bool\",\"name\":\"isValid\",\"type\":\"bool\"}],\"internalType\":\"struct AcademicRecords.Record\",\"name\":\"\",\"type\":\"tuple\"}],\"stateMutability\":\"view\",\"type\":\"function\"}]"],"names":[],"mappings":"AAAA"}},
    {"offset": {"line": 193, "column": 1585}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmed/Desktop/Fifth%20semester/blockchain/project/frontend/app/lib/blockchain.js"],"sourcesContent":["import { ethers } from \"ethers\";\r\nimport ABI from \"../abi.json\";\r\n\r\nfunction validateEnv() {\r\n  const required = [\"PRIVATE_KEY\", \"CONTRACT_ADDRESS\"];\r\n  const missing = required.filter((key) => !process.env[key]);\r\n\r\n  if (missing.length > 0) {\r\n    throw new Error(`Missing required environment variables: ${missing.join(\", \")}`);\r\n  }\r\n}\r\n\r\nvalidateEnv();\r\n\r\n// Provider = read/write connection to the Ethereum JSON-RPC node.\r\n// It talks to Hardhat local chain at http://127.0.0.1:8545.\r\nconst provider = new ethers.JsonRpcProvider(process.env.RPC_URL || \"http://127.0.0.1:8545\");\r\n\r\n// Wallet = backend signing identity. Every state-changing tx is signed with\r\n// this private key before being broadcast. The key must stay server-side only.\r\nconst wallet = new ethers.Wallet(process.env.PRIVATE_KEY, provider);\r\n\r\n// Contract instance bound to the signing wallet.\r\n// Digital signature flow:\r\n// 1) API route calls a write method (e.g., issueRecord).\r\n// 2) ethers prepares transaction data.\r\n// 3) wallet signs tx with PRIVATE_KEY.\r\n// 4) signed tx is sent to chain and validated by nodes.\r\nconst contract = new ethers.Contract(process.env.CONTRACT_ADDRESS, ABI, wallet);\r\n\r\nlet contractCodeValidated = false;\r\n\r\nexport async function ensureContractIsDeployed() {\r\n  if (contractCodeValidated) {\r\n    return;\r\n  }\r\n\r\n  const code = await provider.getCode(process.env.CONTRACT_ADDRESS);\r\n  if (!code || code === \"0x\") {\r\n    throw new Error(\r\n      \"Invalid CONTRACT_ADDRESS: no contract bytecode found. Set CONTRACT_ADDRESS to the deployed AcademicRecords contract address.\"\r\n    );\r\n  }\r\n\r\n  contractCodeValidated = true;\r\n}\r\n\r\nexport { provider, wallet, contract };\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,SAAS;IACP,MAAM,WAAW;QAAC;QAAe;KAAmB;IACpD,MAAM,UAAU,SAAS,MAAM,CAAC,CAAC,MAAQ,CAAC,QAAQ,GAAG,CAAC,IAAI;IAE1D,IAAI,QAAQ,MAAM,GAAG,GAAG;QACtB,MAAM,IAAI,MAAM,CAAC,wCAAwC,EAAE,QAAQ,IAAI,CAAC,OAAO;IACjF;AACF;AAEA;AAEA,kEAAkE;AAClE,4DAA4D;AAC5D,MAAM,WAAW,IAAI,+PAAM,CAAC,eAAe,CAAC,QAAQ,GAAG,CAAC,OAAO,IAAI;AAEnE,4EAA4E;AAC5E,+EAA+E;AAC/E,MAAM,SAAS,IAAI,+PAAM,CAAC,MAAM,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;AAE1D,iDAAiD;AACjD,0BAA0B;AAC1B,yDAAyD;AACzD,uCAAuC;AACvC,uCAAuC;AACvC,wDAAwD;AACxD,MAAM,WAAW,IAAI,+PAAM,CAAC,QAAQ,CAAC,QAAQ,GAAG,CAAC,gBAAgB,EAAE,gKAAG,EAAE;AAExE,IAAI,wBAAwB;AAErB,eAAe;IACpB,IAAI,uBAAuB;QACzB;IACF;IAEA,MAAM,OAAO,MAAM,SAAS,OAAO,CAAC,QAAQ,GAAG,CAAC,gBAAgB;IAChE,IAAI,CAAC,QAAQ,SAAS,MAAM;QAC1B,MAAM,IAAI,MACR;IAEJ;IAEA,wBAAwB;AAC1B"}},
    {"offset": {"line": 251, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmed/Desktop/Fifth%20semester/blockchain/project/frontend/app/api/issue/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { createHash } from \"crypto\";\r\nimport { executeQuery } from \"../../lib/db\";\r\nimport { contract, ensureContractIsDeployed } from \"../../lib/blockchain\";\r\n\r\nexport const runtime = \"nodejs\";\r\n\r\nexport async function POST(request) {\r\n  try {\r\n    await ensureContractIsDeployed();\r\n\r\n    const body = await request.json();\r\n    const { studentId, name, program, certificateData } = body;\r\n\r\n    if (!studentId || !name || !program || !certificateData) {\r\n      return NextResponse.json(\r\n        { success: false, error: \"studentId, name, program, and certificateData are required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Hashing guarantees integrity: if the original certificate data changes,\r\n    // its SHA-256 hash changes, so tampering is detectable.\r\n    const certificateHash = createHash(\"sha256\")\r\n      .update(String(certificateData))\r\n      .digest(\"hex\");\r\n\r\n    await executeQuery(\r\n      `\r\n        INSERT INTO students (student_id, name, program, certificate_hash)\r\n        VALUES (?, ?, ?, ?)\r\n      `,\r\n      [studentId, name, program, certificateHash]\r\n    );\r\n\r\n    // Blockchain write gives immutability: once mined, this transaction\r\n    // history cannot be altered without rewriting chain consensus history.\r\n    const tx = await contract.issueRecord(studentId, certificateHash, \"University\");\r\n    const receipt = await tx.wait();\r\n\r\n    return NextResponse.json(\r\n      {\r\n        success: true,\r\n        message: \"Record issued successfully\",\r\n        studentId,\r\n        certificateHash,\r\n        transactionHash: receipt.hash,\r\n        blockNumber: receipt.blockNumber,\r\n      },\r\n      { status: 201 }\r\n    );\r\n  } catch (error) {\r\n    console.error(\"Issue API error:\", error);\r\n    return NextResponse.json(\r\n      { success: false, error: error.shortMessage || error.message || \"Internal server error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;AAEO,MAAM,UAAU;AAEhB,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,IAAA,yNAAwB;QAE9B,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,OAAO,EAAE,eAAe,EAAE,GAAG;QAEtD,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,WAAW,CAAC,iBAAiB;YACvD,OAAO,mNAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAA6D,GACtF;gBAAE,QAAQ;YAAI;QAElB;QAEA,0EAA0E;QAC1E,wDAAwD;QACxD,MAAM,kBAAkB,IAAA,mHAAU,EAAC,UAChC,MAAM,CAAC,OAAO,kBACd,MAAM,CAAC;QAEV,MAAM,IAAA,qMAAY,EAChB,CAAC;;;MAGD,CAAC,EACD;YAAC;YAAW;YAAM;YAAS;SAAgB;QAG7C,oEAAoE;QACpE,uEAAuE;QACvE,MAAM,KAAK,MAAM,yMAAQ,CAAC,WAAW,CAAC,WAAW,iBAAiB;QAClE,MAAM,UAAU,MAAM,GAAG,IAAI;QAE7B,OAAO,mNAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,SAAS;YACT;YACA;YACA,iBAAiB,QAAQ,IAAI;YAC7B,aAAa,QAAQ,WAAW;QAClC,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,mNAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO,MAAM,YAAY,IAAI,MAAM,OAAO,IAAI;QAAwB,GACxF;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}