{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmed/Desktop/Fifth%20semester/blockchain/project/frontend/app/lib/db.js"],"sourcesContent":["import mysql from \"mysql2/promise\";\r\n\r\nlet pool;\r\n\r\nfunction createPool() {\r\n  const parsedPort = process.env.DB_PORT ? Number(process.env.DB_PORT) : 3306;\r\n\r\n  return mysql.createPool({\r\n    host: process.env.DB_HOST,\r\n    user: process.env.DB_USER,\r\n    password: process.env.DB_PASSWORD,\r\n    database: process.env.DB_NAME || \"academic_system\",\r\n    waitForConnections: true,\r\n    port: Number.isNaN(parsedPort) ? 3306 : parsedPort,\r\n    connectionLimit: 10,\r\n    queueLimit: 0,\r\n  });\r\n}\r\n\r\nexport async function getPool() {\r\n  try {\r\n    if (!pool) {\r\n      pool = createPool();\r\n    }\r\n\r\n    // Lightweight health-check to fail fast if DB credentials are invalid.\r\n    await pool.query(\"SELECT 1\");\r\n    return pool;\r\n  } catch (error) {\r\n    console.error(\"Database connection error:\", error);\r\n    throw new Error(\"Failed to connect to MySQL\");\r\n  }\r\n}\r\n\r\nexport async function executeQuery(sql, params = []) {\r\n  try {\r\n    const db = await getPool();\r\n    const [result] = await db.execute(sql, params);\r\n    return result;\r\n  } catch (error) {\r\n    console.error(\"Database query error:\", error);\r\n    throw new Error(\"Database query failed\");\r\n  }\r\n}\r\n\r\nexport { pool };\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,IAAI;AAEJ,SAAS;IACP,MAAM,aAAa,QAAQ,GAAG,CAAC,OAAO,GAAG,OAAO,QAAQ,GAAG,CAAC,OAAO,IAAI;IAEvE,OAAO,iNAAK,CAAC,UAAU,CAAC;QACtB,MAAM,QAAQ,GAAG,CAAC,OAAO;QACzB,MAAM,QAAQ,GAAG,CAAC,OAAO;QACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;QACjC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;QACjC,oBAAoB;QACpB,MAAM,OAAO,KAAK,CAAC,cAAc,OAAO;QACxC,iBAAiB;QACjB,YAAY;IACd;AACF;AAEO,eAAe;IACpB,IAAI;QACF,IAAI,CAAC,MAAM;YACT,OAAO;QACT;QAEA,uEAAuE;QACvE,MAAM,KAAK,KAAK,CAAC;QACjB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,eAAe,aAAa,GAAG,EAAE,SAAS,EAAE;IACjD,IAAI;QACF,MAAM,KAAK,MAAM;QACjB,MAAM,CAAC,OAAO,GAAG,MAAM,GAAG,OAAO,CAAC,KAAK;QACvC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM,IAAI,MAAM;IAClB;AACF"}},
    {"offset": {"line": 176, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ahmed/Desktop/Fifth%20semester/blockchain/project/frontend/app/api/admin/student-summary/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { executeQuery } from \"../../../lib/db\";\r\n\r\nexport const runtime = \"nodejs\";\r\n\r\nfunction gradeToPoint(grade) {\r\n  const map = {\r\n    \"A+\": 4.0,\r\n    A: 4.0,\r\n    \"A-\": 3.7,\r\n    \"B+\": 3.3,\r\n    B: 3.0,\r\n    \"B-\": 2.7,\r\n    \"C+\": 2.3,\r\n    C: 2.0,\r\n    \"C-\": 1.7,\r\n    \"D+\": 1.3,\r\n    D: 1.0,\r\n    F: 0.0,\r\n  };\r\n  return map[String(grade || \"\").toUpperCase()];\r\n}\r\n\r\nfunction calculateCgpa(rows) {\r\n  let weighted = 0;\r\n  let totalCredits = 0;\r\n\r\n  for (const row of rows) {\r\n    const credits = Number(row.credit_hours || 0);\r\n    const point = gradeToPoint(row.grade);\r\n    if (credits > 0 && Number.isFinite(point)) {\r\n      weighted += point * credits;\r\n      totalCredits += credits;\r\n    }\r\n  }\r\n\r\n  if (totalCredits === 0) {\r\n    return 0;\r\n  }\r\n\r\n  return Number((weighted / totalCredits).toFixed(2));\r\n}\r\n\r\nexport async function GET(request) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const studentId = searchParams.get(\"studentId\");\r\n\r\n    if (!studentId) {\r\n      return NextResponse.json({ success: false, error: \"studentId is required\" }, { status: 400 });\r\n    }\r\n\r\n    const students = await executeQuery(\r\n      `\r\n        SELECT student_id, full_name, email, program, enrollment_year, graduation_year, status\r\n        FROM students\r\n        WHERE student_id = ?\r\n        LIMIT 1\r\n      `,\r\n      [studentId]\r\n    );\r\n\r\n    if (students.length === 0) {\r\n      return NextResponse.json({ success: false, error: \"Student not found\" }, { status: 404 });\r\n    }\r\n\r\n    const courses = await executeQuery(\r\n      `\r\n        SELECT\r\n          sc.course_code,\r\n          c.course_name,\r\n          c.credit_hours,\r\n          sc.grade,\r\n          sc.semester,\r\n          sc.year\r\n        FROM student_courses sc\r\n        INNER JOIN courses c ON c.course_code = sc.course_code\r\n        WHERE sc.student_id = ?\r\n        ORDER BY sc.year, sc.semester\r\n      `,\r\n      [studentId]\r\n    );\r\n\r\n    const activities = await executeQuery(\r\n      `\r\n        SELECT a.activity_name, a.description, sa.participation_date\r\n        FROM student_activities sa\r\n        INNER JOIN activities a ON a.id = sa.activity_id\r\n        WHERE sa.student_id = ?\r\n        ORDER BY sa.participation_date DESC\r\n      `,\r\n      [studentId]\r\n    );\r\n\r\n    const financial = await executeQuery(\r\n      `\r\n        SELECT tuition_paid, clearance_approved, updated_at\r\n        FROM financial_records\r\n        WHERE student_id = ?\r\n        ORDER BY id DESC\r\n        LIMIT 1\r\n      `,\r\n      [studentId]\r\n    );\r\n\r\n    const certificates = await executeQuery(\r\n      `\r\n        SELECT document_hash, blockchain_tx_hash, contract_address, is_revoked, issued_at\r\n        FROM certificates\r\n        WHERE student_id = ?\r\n        ORDER BY id DESC\r\n        LIMIT 1\r\n      `,\r\n      [studentId]\r\n    );\r\n\r\n    const student = students[0];\r\n    const certificate = certificates[0] || null;\r\n\r\n    return NextResponse.json(\r\n      {\r\n        success: true,\r\n        data: {\r\n          student: {\r\n            studentId: student.student_id,\r\n            fullName: student.full_name,\r\n            email: student.email,\r\n            program: student.program,\r\n            enrollmentYear: student.enrollment_year,\r\n            graduationYear: student.graduation_year,\r\n            status: student.status,\r\n          },\r\n          courses,\r\n          cgpa: calculateCgpa(courses),\r\n          activities,\r\n          financial: financial[0] || {\r\n            tuition_paid: false,\r\n            clearance_approved: false,\r\n            updated_at: null,\r\n          },\r\n          certificate: certificate\r\n            ? {\r\n                issued: true,\r\n                documentHash: certificate.document_hash,\r\n                blockchainTxHash: certificate.blockchain_tx_hash,\r\n                contractAddress: certificate.contract_address,\r\n                status: certificate.is_revoked ? \"Revoked\" : \"Valid\",\r\n                issuedAt: certificate.issued_at,\r\n              }\r\n            : { issued: false },\r\n        },\r\n      },\r\n      { status: 200 }\r\n    );\r\n  } catch (error) {\r\n    console.error(\"Student summary API error:\", error);\r\n    return NextResponse.json(\r\n      { success: false, error: error.message || \"Internal server error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}