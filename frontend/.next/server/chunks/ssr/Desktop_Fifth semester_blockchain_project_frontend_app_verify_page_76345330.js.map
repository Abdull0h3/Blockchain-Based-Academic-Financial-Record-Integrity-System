{"version":3,"sources":["../../../../../../../../../Desktop/Fifth%20semester/blockchain/project/frontend/app/verify/page.js"],"sourcesContent":["\"use client\";\r\n\r\nimport { useRef, useState } from \"react\";\r\n\r\nexport default function VerifyPage() {\r\n  const [studentId, setStudentId] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [record, setRecord] = useState(null);\r\n  const [scannerActive, setScannerActive] = useState(false);\r\n  const videoRef = useRef(null);\r\n  const streamRef = useRef(null);\r\n  const rafRef = useRef(null);\r\n  const scannerEnabledRef = useRef(false);\r\n\r\n  async function verifyById(id) {\r\n    setLoading(true);\r\n    setError(\"\");\r\n    setRecord(null);\r\n\r\n    try {\r\n      const response = await fetch(\"/api/verify\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ studentId: id }),\r\n      });\r\n      const payload = await response.json();\r\n      if (!response.ok) {\r\n        throw new Error(payload.error || \"Verification failed\");\r\n      }\r\n      setRecord(payload.data);\r\n    } catch (requestError) {\r\n      setError(requestError.message || \"Unexpected error occurred\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleSubmit(event) {\r\n    event.preventDefault();\r\n    const id = studentId.trim();\r\n    if (!id) {\r\n      setError(\"Please enter student ID\");\r\n      return;\r\n    }\r\n    await verifyById(id);\r\n  }\r\n\r\n  function stopScanner() {\r\n    setScannerActive(false);\r\n    scannerEnabledRef.current = false;\r\n    if (rafRef.current) {\r\n      cancelAnimationFrame(rafRef.current);\r\n    }\r\n    if (streamRef.current) {\r\n      streamRef.current.getTracks().forEach((track) => track.stop());\r\n      streamRef.current = null;\r\n    }\r\n  }\r\n\r\n  async function startScanner() {\r\n    try {\r\n      if (!(\"BarcodeDetector\" in window)) {\r\n        throw new Error(\"QR scanner is not supported in this browser\");\r\n      }\r\n\r\n      const detector = new window.BarcodeDetector({ formats: [\"qr_code\"] });\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: { facingMode: \"environment\" },\r\n      });\r\n      streamRef.current = stream;\r\n      setScannerActive(true);\r\n      scannerEnabledRef.current = true;\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        await videoRef.current.play();\r\n      }\r\n\r\n      const scanLoop = async () => {\r\n        if (!videoRef.current || !scannerEnabledRef.current) {\r\n          return;\r\n        }\r\n        try {\r\n          const codes = await detector.detect(videoRef.current);\r\n          if (codes.length > 0) {\r\n            const rawValue = codes[0].rawValue || \"\";\r\n            const match = rawValue.match(/\\/verify\\/([^/?#]+)/);\r\n            const extractedId = match ? decodeURIComponent(match[1]) : rawValue;\r\n            setStudentId(extractedId);\r\n            stopScanner();\r\n            await verifyById(extractedId);\r\n            return;\r\n          }\r\n        } catch (_scanError) {\r\n          // ignore intermittent frame read errors\r\n        }\r\n        rafRef.current = requestAnimationFrame(scanLoop);\r\n      };\r\n\r\n      rafRef.current = requestAnimationFrame(scanLoop);\r\n    } catch (scannerError) {\r\n      setError(scannerError.message || \"Failed to start scanner\");\r\n      stopScanner();\r\n    }\r\n  }\r\n\r\n  const issueDate = record?.issueDate\r\n    ? new Date(record.issueDate).toLocaleString()\r\n    : record?.timestamp\r\n      ? new Date(Number(record.timestamp) * 1000).toLocaleString()\r\n      : null;\r\n\r\n  return (\r\n    <main style={{ maxWidth: 820, margin: \"0 auto\", display: \"grid\", gap: 12 }}>\r\n      <h1>Employer Verification</h1>\r\n      <form onSubmit={handleSubmit} style={{ display: \"grid\", gap: 8 }}>\r\n        <input\r\n          value={studentId}\r\n          onChange={(e) => setStudentId(e.target.value)}\r\n          placeholder=\"Enter Student ID\"\r\n          style={{ padding: \"0.6rem\" }}\r\n        />\r\n        <div style={{ display: \"flex\", gap: 8, flexWrap: \"wrap\" }}>\r\n          <button type=\"submit\" disabled={loading}>\r\n            {loading ? \"Verifying...\" : \"Verify\"}\r\n          </button>\r\n          {!scannerActive ? (\r\n            <button type=\"button\" onClick={startScanner}>\r\n              Scan QR\r\n            </button>\r\n          ) : (\r\n            <button type=\"button\" onClick={stopScanner}>\r\n              Stop Scanner\r\n            </button>\r\n          )}\r\n        </div>\r\n      </form>\r\n\r\n      {scannerActive ? (\r\n        <video ref={videoRef} style={{ width: \"100%\", maxWidth: 420, borderRadius: 8 }} muted />\r\n      ) : null}\r\n\r\n      {error ? <p style={{ color: \"crimson\" }}>{error}</p> : null}\r\n\r\n      {record ? (\r\n        <section style={{ border: \"1px solid #ddd\", borderRadius: 10, padding: \"1rem\" }}>\r\n          <p><strong>Name:</strong> {record.fullName || \"N/A\"}</p>\r\n          <p><strong>Program:</strong> {record.program || \"N/A\"}</p>\r\n          <p><strong>CGPA:</strong> {record.cgpa ?? \"N/A\"}</p>\r\n          <p><strong>Issuer:</strong> {record.issuer}</p>\r\n          <p><strong>Issue Date:</strong> {issueDate || \"N/A\"}</p>\r\n          <p><strong>Status:</strong> {record.status || (record.isValid ? \"Valid\" : \"Revoked\")}</p>\r\n        </section>\r\n      ) : null}\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}