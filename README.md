## Blockchain-Based Academic Financial Record Integrity System

### Overview

This repository implements a university-grade decentralized application (DApp) for academic records, with a strict separation of concerns:

- **Frontend**: Next.js (App Router) UI
- **Backend Controller Layer**: Next.js API routes
- **Data & Integrity Layer**: MySQL (off-chain storage) + Solidity smart contract (on-chain integrity)

Architecture rule (enforced in code):  
**Frontend → API Routes → (MySQL + Smart Contract)**  
The frontend never talks directly to the database, private keys, or smart contract admin functions.

### Tech Stack

- **Next.js (App Router)** — frontend + API routes
- **Node.js** — backend runtime
- **MySQL** — off-chain storage for student metadata + certificate hash
- **Hardhat** — local Ethereum development environment
- **Solidity 0.8.x** — smart contract (`AcademicRecords.sol`)
- **Ethers.js v6** — blockchain interaction (server-side only)

---

### Project Structure

- `hardhat/`
  - `contracts/AcademicRecords.sol`
  - `scripts/deploy.js`
  - `hardhat.config.js`
  - `.env.example`
- `frontend/`
  - `app/page.js`
  - `app/api/issue/route.js`
  - `app/api/verify/route.js`
  - `lib/db.js`
  - `lib/blockchain.js`
  - `abi.json` (generated by deploy script)
  - `.env.example`
- `.env.example` (root)
- `.gitignore`

---

### 1. Hardhat Setup (Local Blockchain)

#### Install dependencies

```bash
cd hardhat
npm install
```

#### Configure environment

Copy the example file and fill in the admin private key:

```bash
cd hardhat
cp .env.example .env
```

Edit `.env`:

```bash
PRIVATE_KEY=<your-local-hardhat-account-private-key>
```

> The private key must correspond to an account funded on the local Hardhat node.

#### Start Hardhat local node

In one terminal:

```bash
cd hardhat
npx hardhat node
```

This exposes a JSON-RPC endpoint at `http://127.0.0.1:8545`.

#### Deploy the contract

In another terminal, with the node running:

```bash
cd hardhat
npm run deploy:localhost
```

This will:

- Deploy `AcademicRecords` using the `PRIVATE_KEY`.
- Log the deployed contract address.
- Write the address to `hardhat/deployments/AcademicRecords.address.json`.
- Export the contract ABI to `frontend/abi.json` for server-side use.

Copy the deployed contract address for use in the Next.js environment.

---

### 2. SQL Server Database Setup

Create the database and the `students` table in your SQL Server instance (e.g., using SQL Server Management Studio):

```sql
CREATE TABLE students (
  id INT AUTO_INCREMENT PRIMARY KEY,
  student_id VARCHAR(50),
  name VARCHAR(100),
  program VARCHAR(100),
  certificate_hash VARCHAR(255)
);
```

---

### 3. Next.js Frontend + API (App Router)

#### Install dependencies

```bash
cd frontend
npm install
```

#### Configure environment

Copy the example file and fill in values:

```bash
cd frontend
cp .env.example .env.local
```

Edit `.env.local`:

```bash
PRIVATE_KEY=<same-admin-private-key-used-by-hardhat>
CONTRACT_ADDRESS=<deployed_AcademicRecords_address_from_deploy_step>

DB_HOST=localhost
DB_USER=root
DB_PASSWORD=<your-mysql-password>
DB_NAME=academic_system

RPC_URL=http://127.0.0.1:8545
```

> **Security**: `.env.local` is ignored by git. The private key is only used on the server (API routes and backend libs) and is never exposed to the browser.

#### Start the Next.js dev server

```bash
cd frontend
npm run dev
```

Open `http://localhost:3000` in a browser.

---

### 4. Application Flows

#### Issue Record (Admin, via `/api/issue`)

1. Admin (simulated via UI) submits:
   - `studentId`
   - `name`
   - `program`
   - `certificateData` (raw certificate text or JSON)
2. API route:
   - Hashes `certificateData` with SHA-256 using Node’s `crypto` module:

     ```js
     crypto.createHash("sha256").update(data).digest("hex");
     ```

  - Stores `student_id`, `name`, `program`, and `certificate_hash` in SQL Server.
   - Uses Ethers.js v6 + admin `Wallet` to call `issueRecord` on the `AcademicRecords` contract.
3. The transaction is signed by the admin’s private key, providing a digital signature on chain.

#### Verify Record (Public, via `/api/verify`)

1. User submits `studentId` from the UI.
2. API route calls `verifyRecord(studentId)` on the contract.
3. Returns:
   - `studentId`
   - `documentHash`
   - `issuer`
   - `timestamp` (ISO string)
   - `isValid`
4. UI renders the on-chain data. If there is no record or it was revoked, the response clearly indicates that.

---

### 5. Security & Architecture Guarantees

- **No direct DB access from frontend**: All DB queries are in `frontend/lib/db.js`, used only by API routes.
- **No private key in frontend**: `PRIVATE_KEY` is read only on the server, never in client components.
- **Smart contract admin-only operations**: `issueRecord` and `revokeRecord` are protected by the `onlyAdmin` modifier on chain.
- **Integrity via hashing**:
  - Certificates are hashed with SHA-256.
  - Any modification to the original certificate changes the hash.
  - On-chain storage of the hash provides an immutable integrity anchor.

This structure is ready for academic review and can be extended with authentication, role-based admin UI, and additional record metadata as needed.
